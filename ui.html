<h2>Rectangle Creator</h2>
<p>Count: <input id="count" value="1" /></p>
<button id="create">Create</button>
<!-- <button id="send">type送る</button> -->
<button id="cancel">Cancel</button>

<script>
  document.getElementById("create").onclick = () => {
    const textbox = document.getElementById("count");
    const count = parseInt(textbox.value, 10);
    parent.postMessage(
      { pluginMessage: { type: "create-rectangles", count } },
      "*"
    );
    // onmessage = (event) => {
    //   console.log("got this from the plugin code", event.data.pluginMessage);
    // };
    window.onmessage = async (event) => {
      console.log(event.data.pluginMessage)
      if (event.data.pluginMessage.type === "networkRequest") {
        //console.log("-------", event);
        var request = new XMLHttpRequest();
        //request.setRequestHeader('Content-Type', 'application/json' )
        // This link has random lorem ipsum text
        request.open("GET", "");
        //request.responseType = "text";
        // request.onload = () => {
        //   window.parent.postMessage({pluginMessage: request.response}, '*')
        // };
        //console.log("req", request);
        request.send(event.data.pluginMessage);
        console.log("成功",request);
      }
    };
    // window.onmessage = async (event) => {
    //   if (event.data.pluginMessage.type === "networkRequest") {
    //     console.log('^^^^^^^^')
    //     var request = new XMLHttpRequest();
    //     // This link has random lorem ipsum text
    //     request.open(
    //       "GET",
    //       "https://us-central1-pra-functions.cloudfunctions.net/addMessage"
    //     );
    //     request.responseType = "text";
    //     request.onload = () => {
    //       window.parent.postMessage({ pluginMessage: request.response }, "*");
    //     };
    //     request.send();
    //   }
    // };

    // parent.postMessage(
    //   { pluginMessage: { type: "" } },
    //   "*"
    // );
    //parent.postMessage({ pluginMessage: { type: "getNodeById" } }, "*");
    //parent.postMessage({ pluginDrop: PluginDrop }, '*')
    //parent.postMessage({ pluginMessage: { type: "create-message" } }, "*");
    //parent.postMessage({ pluginMessage: { type: "HyperlinkTarget" } }, "*");
    //parent.postMessage({ pluginMessage: "anything here" }, "*");
  };
  // onmessage = (event) => {
  //   console.log("got this from the plugin code", event.data)
  // }
  //常時figma.ui.postmessage(42)を取得してくる関数

  document.getElementById("cancel").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
  };
</script>

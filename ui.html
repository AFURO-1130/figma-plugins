<h2>Rectangle Creator</h2>
<p>Count: <input id="count" value="1" /></p>
<button id="create">Create</button>
<!-- <button id="send">type送る</button> -->
<button id="cancel">Cancel</button>

<script>
  document.getElementById("create").onclick = () => {
    console.log("0000000");
    const textbox = document.getElementById("count");
    const count = parseInt(textbox.value, 10);
    parent.postMessage(
      { pluginMessage: { type: "create-rectangles", count } },
      "*"
    );

    // onmessage = (event) => {
    //   console.log("got this from the plugin code", event.data.pluginMessage);
    // };
    window.onmessage = async (event) => {
      console.log(event.data.pluginMessage);
      console.log("^^^^^^^^^^");
      // if (event.data.pluginMessage.type === "networkRequest") {
      //console.log("-------", event);

      var request = new XMLHttpRequest();
      await request.open(
        "POST",
        "https://us-central1-pra-functions.cloudfunctions.net/hello",
        true
      );
      //await request.send(event.data.pluginMessage);
      await request.send('#hohohh')
      console.log("成功", request);

      // if (request.readyState === 4) {
      // for (let i = 0; i < 2; i++) {

      // }
      // await request.open(
      //   "POST",
      //   "https://us-central1-pra-functions.cloudfunctions.net/hello",
      //   true
      // );
      //request.responseType = "text";
      // request.onload = () => {
      //   window.parent.postMessage({pluginMessage: request.response}, '*')
      // };
      //console.log("req", request);
      // }
      //request.setRequestHeader('Content-Type', 'application/json' )
      // This link has random lorem ipsum text

      // }
    };
    // window.onmessage = async (event) => {
    //   if (event.data.pluginMessage.type === "networkRequest") {
    //     console.log("^^^^^^^^");
    //     var request = new XMLHttpRequest();
    //     // This link has random lorem ipsum text
    //     request.open(
    //       "GET",
    //       "https://us-central1-pra-functions.cloudfunctions.net/addMessage"
    //     );
    //     request.responseType = "text";
    //     request.onload = () => {
    //       window.parent.postMessage({ pluginMessage: request.response }, "*");
    //     };
    //     request.send();
    //   }
    // };

    // parent.postMessage(
    //   { pluginMessage: { type: "" } },
    //   "*"
    // );
    //parent.postMessage({ pluginMessage: { type: "getNodeById" } }, "*");
    //parent.postMessage({ pluginDrop: PluginDrop }, '*')
    //parent.postMessage({ pluginMessage: { type: "create-message" } }, "*");
    //parent.postMessage({ pluginMessage: { type: "HyperlinkTarget" } }, "*");
    //parent.postMessage({ pluginMessage: "anything here" }, "*");
  };
  // onmessage = (event) => {
  //   console.log("got this from the plugin code", event.data)
  // }
  //常時figma.ui.postmessage(42)を取得してくる関数

  document.getElementById("cancel").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
  };
</script>
